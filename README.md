# weatherAdvisorVkBot
chat-bot for vk: tells weather forecast and sends notifications

[Умный сервис прогноза погоды](https://www.notion.so/03f6716315e04acea3023766e5f2cc0e)

* __Сложность:__ со звездочкой
* __Язык:__ Python (Clean) +vk api, openweather api
* __БД__: PostgreSQL
* __Интерфейс:__ чат-бот в ВК

* __Взаимодействие:__ бот получает команду от пользователя, обрабатывает на сервере, записывает информацию в базу, чтобы в будущем использовать для формирования ответа этому пользователю. Взаимодействие происходит через Longpoll VK API. Если это команда с погодой, то, в том числе, сервер отправляет запрос к openweather api. Ответ в виде текста (сообщение в диалоге).
Если это запрос погоды: 
```
Погода в городе ГородНейм:

ясно/пасмурно/дождь/облачно/etc.
Температура: N ℃
Ощущается как N ℃
Скорость ветра: N м/с
Рассвет: Время. Закат: Время
```

* __Демонстрация работы:__ https://www.loom.com/share/07bb160dded24ec1a0303d7576531826

* __Ссылка на группу с ботом__: https://vk.com/weatheradvisor

* __Что бот вообще умеет:__

1) Отправлять погоду в любом городе.
2) Запоминать город пользователя и отправлять всегда погоду в этом городе.
3) Давать советы, исходя из того, какая погода в городе пользователя.
4) Отправлять ежедневные уведомления о погоде. Пользователь может выбрать время.
5) Советовать фильм, исходя из того, какая погода в городе попльзователя.

* __Работа пошагово:__
1) Юзер отправляет команду.
2) Сервер на верхнем уровне (WeatherAdvisorMain) её парсит и передает ниже - обработчику.
3) Обработчик (delivery) изучает задачу, которую дал пользователь, разбивает на компоненты.
4) Компоненты, обычно, это задачи по получению информации из апи погоды, вк или базы данных пользователей. 
5) Полученные данные обработчик получает, обрабатывает, собирает и отдает наверх, если возникли ошибки, проставляет соответсвующий код.
6) Наверху готовое сообщение-ответ отправляется пользователю, учитывая код ответа от обработчика.

* __Запуск бота:__
```
$ git clone https://github.com/Serjio2888/weatherAdvisorVkBot
$ cd weatherAdvisorVkBot
$ docker build --tag weatheradvisor .
$ docker run --detach --name weatheradvisorContainer weatheradvisor
```
Для корректной работы в папку с ботом надо добавить файл ```credentials.py``` такого содержания:
```
vk_token = "VK API TOKEN"
host = "database host"
port = db_port_int
username = "db user name"
db_name = "db name"
db_pass = "db password"
```
В базе, к которой собираетесь подключиться, предварительно создать и заполнить таблицы. Код лежит в ```script.sql```

База фильмов - распарсил Топ Кинопоиска и руками проставил настроение фильмам.
